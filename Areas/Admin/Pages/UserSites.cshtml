@page
@model iTech.Areas.Admin.Pages.UserSitesModel
@{
    Layout = "_Layout";
}
<div class="d-flex flex-column flex-column-fluid">
    <!--begin::Toolbar-->
    <div id="kt_app_toolbar" class="app-toolbar  py-3 py-lg-6 ">
        <!--begin::Toolbar container-->
        <div id="kt_app_toolbar_container" class="app-container  container-xxl d-flex flex-stack ">
            <!--begin::Page title-->
            <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3 ">
                <!--begin::Title-->
                @*<h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">
                Orders Listing
                </h1>*@
                <!--end::Title-->
                <!--begin::Breadcrumb-->
                <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                    <!--begin::Item-->
                    <li class="breadcrumb-item text-muted">
                        <a href="/admin/index" class="text-muted text-hover-primary">
                            @sharedResource["Home"]
                        </a>
                    </li>
                    <!--end::Item-->
                    <!--begin::Item-->
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <!--end::Item-->
                    <!--begin::Item-->
                    <li class="breadcrumb-item text-muted">
                        @sharedResource["User Sites"]
                    </li>
                    <!--end::Item-->
                    <!--begin::Item-->
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <!--end::Item-->
                </ul>
                <!--end::Breadcrumb-->
            </div>
        </div>
        <!--end::Toolbar container-->
    </div>
    <!--end::Toolbar-->
    <!--begin::Content-->
    <div id="kt_app_content" class="app-content  flex-column-fluid ">
        <!--begin::Content container-->
        <div id="kt_app_content_container" class="app-container  container-xxl ">
            <!--begin::Products-->
            <div class="row" style="margin-bottom: 3rem;">
                <div class="col-xxl-3 col-sm-6">
                    <div class="card card-animate">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <i class="ki-duotone ki-chart-pie-simple text-white fs-2x ms-n1"><span class="path1"></span><span class="path2"></span></i>

                                    <p class="fw-medium text-muted mb-0">@sharedResource["Sites Count"]</p>
                                    <h2 class="mt-4 ff-secondary fw-semibold"><span class="counter-value">@Model.SitesCount</span></h2>

                                </div>
                                <div>
                                    <div class="avatar-sm flex-shrink-0">
                                        <span class="avatar-title bg-soft-info text-info rounded-circle fs-4">
                                            <i class="mdi mdi-timer-sand"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div><!-- end card body -->
                    </div>
                </div><!--end col-->
                <div class="col-xl-3 col-sm-6">
                    <div class="card card-animate">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <i class="ki-duotone ki-chart-pie-simple text-white fs-2x ms-n1"><span class="path1"></span><span class="path2"></span></i>

                                    <p class="fw-medium text-muted mb-0">@sharedResource["User Count"]</p>
                                    <h2 class="mt-4 ff-secondary fw-semibold"><span class="counter-value">@Model.UsersCount</span></h2>

                                </div>
                                <div>
                                    <div class="avatar-sm flex-shrink-0">
                                        <span class="avatar-title bg-soft-info text-info rounded-circle fs-4">
                                            <i class="ri-shopping-bag-line"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div><!-- end card body -->
                    </div>
                </div><!--end col-->
            </div><!--end row-->
        </div>
    </div>
</div>
<div class="row g-6 g-xl-9 p-9">
    <!--begin::Col-->
    @{
        if (Model.CurrentPageSites != null)
        {
            if (Model.CurrentPageSites.Count > 0)
            {
                foreach (var item in Model.CurrentPageSites)
                {
                            <div class="col-sm-6 col-xl-4">
                                <!--begin::Card-->
                                <div class="card h-100">
                                    <!--begin::Card header-->
                                    <div class="card-header flex-nowrap border-0 pt-9">
                                        <!--begin::Card title-->
                                        <div class="card-title m-0">
                                            <!--begin::Icon-->
                                            <div class="symbol symbol-45px w-45px bg-light me-5">
                                        <img style="width:412px!important;height:291px!important" src="/@item.Templates.TemplatePic" alt="image" class="p-3">
                                            </div>
                                            <!--end::Icon-->
                                            <!--begin::Title-->
                                            <!--end::Title-->
                                        </div>
                                        <!--end::Card title-->
                                       
                                    </div>
                                    <!--end::Card header-->
                                    <!--begin::Card body-->
                                    <div class="card-body d-flex flex-row px-9 pt-6 pb-8">
                                        <!--begin::Heading-->
                                        <div class="fs-2tx fw-bold mb-3 col-8">
                                            <a href="/Editor?id=@item.SiteId" class="menu-link flex-stack px-3">
                                                @item.SiteTitle
                                            </a>


                                        </div>
                                <div class="card-toolbar m-0 col-4 text-end">
                                    <!--begin::Menu-->
                                    <button type="button" class="btn btn-clean btn-sm btn-icon btn-icon-primary btn-active-light-primary me-n3" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                        <i class="ki-duotone ki-element-plus fs-3 text-primary">
                                            <span class="path1"></span>
                                            <span class="path2"></span>
                                            <span class="path3"></span>
                                            <span class="path4"></span>
                                            <span class="path5"></span>
                                        </i>
                                    </button>
                                    <!--begin::Menu 3-->
                                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px py-3" data-kt-menu="true" style="">
                                        <!--begin::Heading-->
                                        <div class="menu-item px-3">
                                            <div class="menu-content text-muted pb-2 px-3 fs-7 text-uppercase">Actions</div>
                                        </div>
                                        <!--end::Heading-->
                                        <!--begin::Menu item-->
                                        <div class="menu-item px-3">
                                            <a href="/@item.SiteTitle" class="menu-link px-3">Preview</a>
                                        </div>
                                        <!--end::Menu item-->
                                        <!--begin::Menu item-->
                                        <div class="menu-item px-3">
                                            <a href="/SiteEditor?id=@item.SiteId" class="menu-link flex-stack px-3">
                                                Edit
                                            </a>
                                        </div>
                                        <!--end::Menu item-->
                                        <!--begin::Menu item-->
                                        
                                        <div class="menu-item px-3">

                                            <span class="text-end">
                                                <a href="#" data-bs-toggle="modal" class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1">

                                                    <i class="ki-duotone ki-eye fs-2x" onclick="ShowUserSiteViewPopUp(@item.SiteId)">
                                                        <span class="path1"></span>
                                                        <span class="path2"></span>
                                                        <span class="path3"></span>
                                                    </i>
                                                </a>
                                               @* <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1" data-bs-toggle="modal" data-bs-target="#kt_modal_EditUserSite">
                                                    <i class="ki-duotone ki-pencil fs-2" onclick="editButtonClickUserSite(156)">
                                                        <span class="path1"></span>
                                                        <span class="path2"></span>
                                                    </i>
                                                </a>*@

                                                <a href="#" class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm" data-bs-toggle="modal" data-bs-target="#kt_modal_DeleteUserSite">
                                                    <i class="ki-duotone ki-trash fs-2" onclick="deleteUserSite(@item.SiteId)">
                                                        <span class="path1"></span>
                                                        <span class="path2"></span>
                                                        <span class="path3"></span>
                                                        <span class="path4"></span>
                                                        <span class="path5"></span>
                                                    </i>
                                                </a>


                                            </span>

                                        </div>
                                        <!--end::Menu item-->
                                        <!--end::Menu item-->
                                    </div>
                                    <!--end::Menu 3-->
                                    <!--end::Menu-->
                                </div>
                                    </div>
                                    <!--end::Card body-->
                                </div>
                                <!--end::Card-->
                            </div>
                }
            }
        }
    }
</div>
<div class="d-flex flex-stack flex-wrap pt-10 p-9">
    <!-- Display the number of entries shown -->
    <div class="fs-6 fw-semibold text-gray-700">Showing @((Model.CurrentPage - 1) * Model.PageSize + 1) to @((Model.CurrentPage - 1) * Model.PageSize + Model.CurrentPageSites.Count) of @Model.siteList.Count entries</div>
    <ul class="pagination">
        <!-- Previous page link -->
        @if (Model.CurrentPage > 1)
        {
            <li class="page-item previous">
                <a href="?page=@(Model.CurrentPage - 1)" class="page-link">
                    <i class="previous"></i>
                </a>
            </li>
        }
        <!-- Page numbers -->
        @for (int i = 1; i <= Math.Ceiling(Model.siteList.Count / (double)Model.PageSize); i++)
        {
            <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                <a href="?pageId=@i" class="page-link">@i</a>
            </li>
        }
        <!-- Next page link -->
        @if (Model.CurrentPage < Math.Ceiling(Model.siteList.Count / (double)Model.PageSize))
        {
            <li class="page-item next">
                <a href="?pageId=@(Model.CurrentPage + 1)" class="page-link">
                    <i class="next"></i>
                </a>
            </li>
        }
    </ul>
</div>


<partial name="_DeleteUserSite" model="@Model.userSite" view-data=" ViewData" />
<partial name="_ViewUserSite" model="@Model.userSite" view-data=" ViewData" />
<partial name="_EditUserSite" model="@Model.userSite" view-data=" ViewData" />

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#deleteLink").click(function (e) {
            e.preventDefault(); // Prevent the default link behavior (navigating to the "#" URL)
            // Trigger the form submission
            $("#deleteForm").submit();
        });
    });

    function ShowUserSiteViewPopUp(SiteId) {

        $.ajax({
            type: "GET",
            url: "/Admin/UserSites?handler=SingleUserSiteView",
            data: { "SiteId": SiteId },
            contentType: "application/json",
            dataType: "json",
            success: function (response) {



                document.getElementById("DFBCTitleArId").innerHTML = response.SiteTitle
                document.getElementById("DFBCTitleEnId").innerHTML = response.UserDomain
                const createdDate = new Date(response.CreatedDate);

                const month = String(createdDate.getMonth() + 1).padStart(2, '0'); // Adding 1 because months are zero-based
                const day = String(createdDate.getDate()).padStart(2, '0');
                const year = createdDate.getFullYear();

                const formattedDate = `${month}/${day}/${year}`;

                document.getElementById("DUserOneFeedbackArId").innerHTML = formattedDate; if (response.IsPaid) {
                    document.getElementById("DUserOneFeedbackEnId").innerHTML = "Paid"

                } else {
                    document.getElementById("DUserOneFeedbackEnId").innerHTML = "Not Paid"

                }
                if (response.IsActive) {
                    document.getElementById("DqUserOneFeedbackEnId").innerHTML = "Paid"

                } else {
                    document.getElementById("DqUserOneFeedbackEnId").innerHTML = "Not Paid"

                }
                document.getElementById("DUserTwoFeedbackArId").innerHTML = response.UserTemplatePrice

                $.ajax({
                    type: "GET",
                    url: "/Admin/UserSites?handler=SingleUserForView",
                    data: { "UserID": response.UserID },
                    contentType: "application/json",
                    dataType: "json",
                    success: function (userResponse) {
                        console.log(userResponse);
                        if (userResponse != null) {
                            document.getElementById("FullName").innerHTML = userResponse.FullName;
                            document.getElementById("Email").innerHTML = userResponse.Email;
                            document.getElementById("PhoneNumber").innerHTML = userResponse.PhoneNumber;
                        } else {
                            document.getElementById("FullName").innerHTML = "There is No User Name";
                            document.getElementById("Email").innerHTML = "There is No User Email";
                            document.getElementById("PhoneNumber").innerHTML = "There is No Phone Number";
                        }
                    },
                    failure: function (userResponse) {
                        alert(userResponse);
                    }
                });

                $('#QuickViewUserSite').modal('show');

            },
            failure: function (response) {
                alert(response);
            }
        });

    }

    function editButtonClickUserSite(SiteId) {
        $.ajax({
            type: "GET",
            beforeSend: function (xhr) {
                xhr.setRequestHeader("XSRF-TOKEN",
                    $('input:hidden[name="__RequestVerificationToken"]').val());
            }
            ,
            url: "/Admin/PublicContentEditor?handler=SingleBrandForEdit",

            data: { "SiteId": SiteId },
            contentType: "application/json",
            dataType: "json",
            success: function (response) {
                document.getElementById("HiddenUserSiteId").value = response.SiteId
                document.getElementById("UserSiteTitle").value = response.SiteTitle
                $('#showUserSiteEditModal').modal('show');
            },

            failure: function (response) {
                alert(response);
            }
        });
    }


    function deleteUserSite(SiteId) {
        $.ajax({
            type: "GET",
            url: "/Admin/UserSites?handler=SingleUserSiteForDelete",
            data: { "SiteId": SiteId },
            contentType: "application/json",
            dataType: "json",
            success: function (response) {
                document.getElementById("DeleteUserSiteId").value = response.SiteId
                $('#kt_modal_DeleteUserSite').modal('show');


            },
            failure: function (response) {
                alert(response);
            }
        });
    }
</script>
